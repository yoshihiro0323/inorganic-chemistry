\documentclass[dvipdfmx,a4paper,13pt]{jsarticle}
\usepackage[deluxe]{otf}
\usepackage[top=20truemm,bottom=20truemm,left=15truemm,right=15truemm]{geometry}
\usepackage{multirow}
\usepackage{mhchem}
\usepackage{color}
\usepackage[dvipsnames]{xcolor}
\usepackage{enumerate}
\usepackage{tikz}
\usepackage{lscape}
\usepackage{amsmath}
\usepackage{chemfig}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage[dvipdfmx]{hyperref}
\usepackage{ascmac}
\usepackage{multicol}
\usepackage{amssymb}
\usepackage{longtable}

\usetikzlibrary{calc}

\makeatletter
\def\section{\@startsection {section}{1}{\z@}{-2.5ex plus -1ex minus -.2ex}{2.5 ex plus .2ex}{\Large \bfseries \sffamily}}
\def\subsection{\@startsection {subsection}{1}{\z@}{-1.5ex plus -1ex minus -.2ex}{2.3 ex plus .2ex}{\Large \sffamily}}
\def\subsubsection{\@startsection {subsubsection}{1}{\z@}{-2.5ex plus -1ex minus -.2ex}{.3 ex plus .2ex}{\large \sffamily}}
\makeatother

\newcommand{\answer}[1]{\!
  \begin{tikzpicture}[baseline=(num.base),font=\sffamily\small]
   \node[draw=black, rectangle, rounded corners=2pt,
          text=black,
          line width=.5pt, inner sep=2pt, outer sep=0pt
          ] (num){\addtocounter{answer}{1}\arabic{answer}};
   \node [right, inner sep=1pt, outer sep=0pt] (text) at (num.east){#1};
   \draw [line width=.5pt, outer sep=0pt] (num.south)--($(text.base east)-(num.base west)+(num.south)+(-5pt,0)$);
  \end{tikzpicture}%
}
\newcounter{answer}
\newcommand{\hl}[1]{\answer{\textcolor{red}{#1}}}\newcommand{\hce}[1]{\textcolor{blue}{\ce{#1}}}\newcommand{\hlbox}[1]{\fbox{\textcolor{red}{\gtfamily #1}}}\rfoot{解答編}
%\newcommand{\hl}[1]{\answer{\phantom{あいう}}}\newcommand{\hce}[1]{\fbox{\textcolor{white}{\ce{#1}}}}\newcommand{\hlbox}[1]{\fbox{\phantom{#1}}}\rfoot{空欄編}

\pagestyle{empty}

\newcommand{\stamp}[2]{%
  \begin{tikzpicture}[baseline=(A.base),font=\sffamily\small]
    \node[draw=#1, rectangle, rounded corners=2pt,
          text=#1,
          fill=#1!10!white,
          line width=.4pt, inner sep=1pt, outer sep=0pt
          ] (A) {#2};
  \end{tikzpicture}%
}
\newcommand{\K}{\stamp{blue}{工業的製法}}
\newcommand{\R}{\stamp{red}{例}}

\columnseprule=0.2mm

\pagestyle{fancy}
\lfoot{\hyperlink{top}{無機化学}}
\cfoot{\thepage/\pageref{LastPage}}

\hypersetup{
 bookmarks=false,
 colorlinks=true,
 linkcolor=black,
 citecolor=[rgb]{0,0.4,0.8},
 filecolor=black,
 urlcolor=[rgb]{0,0.4,0.8}
}

\begin{document}

%\setchemfig{debug=true}
%\setcharge{debug}

\thispagestyle{fancy}

\twocolumn
\twocolumn[
\begin{center}
\Huge{\gtfamily 無機化学}\\
\vspace{5mm}
\end{center}
]

\hypertarget{top}{\tableofcontents}
\onecolumn
%\include{children/non‐metallic}
%\include{children/representative}
%\include{children/transition}
\renewcommand{\thesection}{\Alph{section}}
\setcounter{section}{0}
%\include{children/appendix}
\begin{tikzpicture}[process/.style={right, draw=black, rectangle, semithick, rounded corners=3pt, dash dot},arrow/.style={-Stealth,thick},extract/.style={right, draw=black, rectangle, semithick, rounded corners=3pt}]
 \node[below right, draw=black, rectangle, rounded corners=4pt, line width=1pt, inner sep=4pt, outer sep=0pt] (begin) {金属イオンの混合溶液};
  \node[below right, draw=black, rectangle, rounded corners=4pt, line width=1pt, inner sep=4pt, outer sep=0pt] (end) at (0,-23) {\hl{\ce{K^+}},\hl{\ce{Na^+}},\hl{\ce{Mg^+}}};
 \coordinate (start point) at ($(begin.south west)!0.15!(begin.south east)$);
 \coordinate (end point) at ($(start point) + (end.north west) - (begin.south west)$);
 \coordinate (extract1) at ([yshift=-2cm]start point);
 \coordinate (extract2) at ([yshift=-7cm]start point);
 \coordinate (extract3) at ([yshift=-13cm]start point);
 \coordinate (extract4) at ([yshift=-16cm]start point);
 \coordinate (extract5) at ([yshift=-21cm]start point);
 
 \node[process] (1st) at ([xshift=1cm]$(start point)!0.5!(extract1)$){
 \begin{minipage}{3cm}
 \hl{希塩酸}\\
 $\Rightarrow$\hl{\ce{Cl-}}（\hl{酸}性）
 \end{minipage}
 };
 \node[process] (2nd) at ([xshift=1cm]$(extract1)!0.5!(extract2)$){
 \begin{minipage}{3cm}
 \hl{硫化水素}\\
 $\Rightarrow$\hl{\ce{S^2-}}（\hl{酸}性）
 \end{minipage}
 };
 \node[process] (3rd) at ([xshift=1cm]$(extract2)!0.5!(extract3)$){
 \begin{minipage}{7.5cm}
 \begin{enumerate}
 \setlength{\leftskip}{-13pt}
 \item \hl{煮沸}する$\Rightarrow$\hl{硫化水素}を除去
 \item \hl{希硝酸}を加える\\
 \hce{Fe^2+ -> Fe^3+}
 \item 過剰の\hl{アンモニア水}を加える（＋\ce{NH4Cl}）\\
 少量の\hl{\ce{OH-}}（\hl{緩衝}作用で\hl{強塩基}性）\\
 \hl{アンミン錯イオン}の生成
 \end{enumerate}
 \end{minipage}
 };
 \node[process] (4th) at ([xshift=1cm]$(extract3)!0.5!(extract4)$){
 \begin{minipage}{3.5cm}
 \hl{硫化水素}を加える\\
 \hl{\ce{S^2-}}（\hl{塩基}性）
 \end{minipage}
 };
 \node[process] (5th) at ([xshift=1cm]$(extract4)!0.5!(extract5)$){
 \begin{minipage}{6cm}
 \begin{enumerate}
 \setlength{\leftskip}{-13pt}
 \item \hl{酢酸}を加えて\hl{煮沸}する\\
 \hl{硫化水素}を除去（\hl{弱酸遊離}）
 \item \hl{炭酸アンモニウム}（＋\ce{NH4Cl}）\\
 少量の\hl{\ce{CO3^2-}}
 \end{enumerate}
 \end{minipage}
 };
 
 \draw[arrow] (start point) -- (end point);
 \draw[arrow] (1st.west) -- ($(start point)!(1st.west)!(end point)$);
 \draw[arrow] (2nd.west) -- ($(start point)!(2nd.west)!(end point)$);
 \draw[arrow] (3rd.west) -- ($(start point)!(3rd.west)!(end point)$);
 \draw[arrow] (4th.west) -- ($(start point)!(4th.west)!(end point)$);
 \draw[arrow] (5th.west) -- ($(start point)!(5th.west)!(end point)$);
 
 \node[extract] (group1) at ([xshift=5cm]extract1) {
 \begin{tabular}{ll|ll}
 \hl{\ce{AgCl}}&\hl{白}色&\hl{\ce{Hg2Cl2}}&\hl{白}色\\
 \hl{\ce{PbCl2}}&\hl{白}色&&
 \end{tabular}
 };
 \node[extract, above] (group1-result) at ([yshift=-3cm]group1.south){\ce{Hg,Hg(NH2)Cl}};
 \coordinate (group1-end point) at (group1-result.north);
 \coordinate (group1-start point) at ($(group1.south west)!(group1-end point)!(group1.south east)$);
 \draw[arrow] (group1-start point) -- (group1-end point);
 \node[process] (group1-1) at ([xshift=1cm]$(group1-start point)!0.2!(group1-end point)$){\hl{熱水}を加える};
 \node[extract, left] (group1-2) at ([xshift=-1cm]$(group1-start point)!0.4!(group1-end point)$){\hl{\ce{Pb^2+}}};
 \node[process] (group1-3) at ([xshift=1cm]$(group1-start point)!0.6!(group1-end point)$){\hl{熱水}を加える};
 \node[extract, left] (group1-4) at ([xshift=-1cm]$(group1-start point)!0.8!(group1-end point)$){\hl{\ce{Ag+}}};
 
 \draw[arrow] (group1-1.west) -- ($(group1-start point)!(group1-1.west)!(group1-end point)$);
 \draw[arrow] ($(group1-start point)!(group1-2.east)!(group1-end point)$) -- (group1-2.east);
 \draw[arrow] (group1-3.west) -- ($(group1-start point)!(group1-3.west)!(group1-end point)$);
 \draw[arrow] ($(group1-start point)!(group1-4.east)!(group1-end point)$) -- (group1-4.east);
 
 \node[extract] (group2) at ([xshift=5cm]extract2) {
 \begin{tabular}{ll|ll}
 \hl{\ce{HgS}}&\hl{黒}色&\hl{\ce{CuS}}&\hl{黒}色\\
 \hl{\ce{SnS}}&\hl{褐}色&\hl{\ce{CdS}}&\hl{黄}色\\
 （\hl{\ce{PbCl2}}&\hl{黒}色）&&
 \end{tabular}
 };
 \node[extract, above] (group2-result) at ([yshift=-4cm]$(group2.south)!1.3!(group2.south east)$){\hl{\ce{Cu^2+}}};
 \coordinate (group2-end point) at (group2-result.north);
 \coordinate (group2-start point) at ([yshift=-0.5cm]$(group2.west)!(group2-end point)!(group2.east)$);
 \draw[arrow] (group2.east) -| (group2-end point);
 \node[process] (group2-1) at ([xshift=1cm]$(group2-start point)!0.14!(group2-end point)$){沈澱の色};
 \node[extract, left] (group2-2) at ([xshift=-1cm]$(group2-start point)!0.28!(group2-end point)$){\hl{\ce{SnS}}・\hl{\ce{CdS}}};
 \node[process] (group2-3) at ([xshift=1cm]$(group2-start point)!0.42!(group2-end point)$){希硝酸を加えて加熱};
 \node[extract, left] (group2-4) at ([xshift=-1cm]$(group2-start point)!0.56!(group2-end point)$){\ce{HgS}};
 \node[process] (group2-5) at ([xshift=1cm]$(group2-start point)!0.70!(group2-end point)$){希硫酸を加える};
 \node[extract, left] (group2-6) at ([xshift=-1cm]$(group2-start point)!0.84!(group2-end point)$){\hl{\ce{Pb^2+}}};
 
 \draw[arrow] (group2-1.west) -- ($(group2-start point)!(group2-1.west)!(group2-end point)$);
 \draw[arrow] ($(group2-start point)!(group2-2.east)!(group2-end point)$) -- (group2-2.east);
 \draw[arrow] (group2-3.west) -- ($(group2-start point)!(group2-3.west)!(group2-end point)$);
 \draw[arrow] ($(group2-start point)!(group2-4.east)!(group2-end point)$) -- (group2-4.east);
 \draw[arrow] (group2-5.west) -- ($(group2-start point)!(group2-5.west)!(group2-end point)$);
 \draw[arrow] ($(group2-start point)!(group2-6.east)!(group2-end point)$) -- (group2-6.east);
 
 \node[extract] (group3) at ([xshift=4cm]extract3) {
 \begin{tabular}{ll|ll}
 \hl{\ce{Fe(OH)3}}&\hl{淡緑}色&\hl{\ce{Cr(OH)3}}&\hl{黒}色\\
 \hl{\ce{Al(OH)3}}&\hl{白}色&&
 \end{tabular}
 };
 \node[process] (group3-1) at ([xshift=1cm]group3.east){沈澱の色};
 \draw[arrow] (group3-1.west) -- ($(group3.north east)!(group3-1.west)!(group3.south east)$);
 
 \node[extract] (group4) at ([xshift=4cm]extract4) {
 \begin{tabular}{ll|ll}
 \hl{\ce{NiS}}&\hl{黒}色&\hl{\ce{CoS}}&\hl{黒}色\\
 \hl{\ce{ZnS}}&\hl{白}色&\hl{\ce{MnS}}&\hl{淡黄}色\\
 \end{tabular}
 };
 \node[process] (group4-1) at ([xshift=1cm]group4.east){
 \begin{minipage}{5.2cm}
 沈澱の色・元の混合溶液の色\\
 \begin{tabular}{l|l}
 \ce{Ni^2+}\hl{緑}色&\ce{Co^2+}\hl{淡赤}色
 \end{tabular}
 \end{minipage}};
 \draw[arrow] (group4-1.west) -- ($(group4.north east)!(group4-1.west)!(group4.south east)$);
 
 \node[extract] (group5) at ([xshift=4cm]extract5) {
 \begin{tabular}{ll|ll}
 \hl{\ce{CaCO3}}&\hl{白}色&\hl{\ce{BaCO3}}&\hl{白}色\\
 \hl{\ce{StCO3}}&\hl{白}色&&
 \end{tabular}
 };
 \node[extract, above] (group5-result) at ([yshift=3cm]$(group5.south)!1.3!(group5.south east)$){\hl{\ce{BaCrO4}}};
 \coordinate (group5-end point) at (group5-result.south);
 \coordinate (group5-start point) at ([yshift=0.5cm]$(group5.west)!(group5-end point)!(group5.east)$);
 \draw[arrow] (group5.east) -| (group5-end point);
 \node[process] (group5-1) at ([xshift=1cm]$(group5-start point)!0.33!(group5-end point)$){
 \begin{minipage}{3.6cm}
 希酢酸に溶解して、\\クロム酸カリウム水溶液を加える
 \end{minipage}};
 \node[extract, left] (group5-2) at ([xshift=-1cm]$(group5-start point)!0.67!(group5-end point)$){\hl{\ce{SnS}}・\hl{\ce{CdS}}};
 
 \draw[arrow] (group5-1.west) -- ($(group5-start point)!(group5-1.west)!(group5-end point)$);
 \draw[arrow] ($(group5-start point)!(group5-2.east)!(group5-end point)$) -- (group5-2.east);
 
 \node[extract, right] (group6-result) at ([xshift=7cm,yshift=-2cm]end.west){\ce{Na+,K+}};
 \coordinate (group6-end point) at (group6-result.north);
 \coordinate (group6-start point) at ([yshift=0.5cm]$(end.west)!(group6-end point)!(end.east)$);
 \draw[arrow] (end.east) -| (group6-end point);
 \node[process] (group6-1) at ([xshift=1cm]$(group6-start point)!0.33!(group6-end point)$){
 \begin{minipage}{7cm}
 弱酸性下で、リン酸水素にナトリウム水溶液と\\アンモニア水を加える。
 \end{minipage}};
 \node[extract, left] (group6-2) at ([xshift=-1cm]$(group6-start point)!0.67!(group6-end point)$){\ce{MgNH4PO4*6H2O}};
 
 \draw[arrow] (group6-1.west) -- ($(group6-start point)!(group6-1.west)!(group6-end point)$);
 \draw[arrow] ($(group6-start point)!(group6-2.east)!(group6-end point)$) -- (group6-2.east);
 
 \node[process] (group6-3) at ([xshift=1cm]group6-result.east){
 \begin{minipage}{5.2cm}
 炎色反応\\
 \begin{tabular}{l|l}
 \ce{Na}\hl{黄}色&\ce{K}\hl{赤紫}色
 \end{tabular}
 \end{minipage}};
 \draw[arrow] (group6-3.west) -- (group6-result.east);
 
 \draw[arrow] (extract1) -- (group1.west);
 \draw[arrow] (extract2) -- (group2.west);
 \draw[arrow] (extract3) -- (group3.west);
 \draw[arrow] (extract4) -- (group4.west);
 \draw[arrow] (extract5) -- (group5.west);
 
 \end{tikzpicture}
\end{document}